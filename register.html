<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Đăng ký</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
 margin:0;height:100vh;
 background:linear-gradient(135deg,#141e30,#243b55);
 font-family:Arial;
 display:flex;justify-content:center;align-items:center;
 color:#fff
}
.box{
 width:360px;
 background:#1f1f1f;
 border-radius:18px;
 padding:28px;
 box-shadow:0 20px 40px rgba(0,0,0,.6)
}
h2{
 text-align:center;
 color:#f5c542;
 margin-bottom:14px
}

/* FORM MESSAGE */
.form-msg{
 display:none;
 margin-bottom:14px;
 padding:10px 12px;
 border-radius:10px;
 text-align:center;
 font-size:14px;
 font-weight:bold;
}
.form-msg.error{background:#e74c3c;color:#fff}
.form-msg.warn{background:#f1c40f;color:#333}
.form-msg.success{background:#2ecc71;color:#fff}

input{
 width:100%;
 padding:12px;
 margin-bottom:14px;
 border:none;
 border-radius:12px;
 background:#2d2d2d;
 color:#fff
}
button{
 width:100%;
 padding:12px;
 border:none;
 border-radius:14px;
 background:#3f63d8;
 color:#fff;
 font-weight:bold;
 cursor:pointer
}
button:hover{background:#3554c5}

a{
 display:block;
 text-align:center;
 margin-top:14px;
 color:#bbb;
 text-decoration:none
}
a:hover{color:#fff}

/* LOADING */
.loading{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.7);
 display:none;
 justify-content:center;
 align-items:center;
 z-index:999
}
.spinner{
 width:60px;height:60px;
 border:6px solid #444;
 border-top-color:#3f63d8;
 border-radius:50%;
 animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="box">
 <h2>Đăng ký</h2>

 <!-- MESSAGE -->
 <div id="formMsg" class="form-msg"></div>

 <input id="user" placeholder="Tên đăng nhập">
 <input id="pass" type="password" placeholder="Mật khẩu">
 <input id="repass" type="password" placeholder="Nhập lại mật khẩu">

 <button onclick="register()">Đăng ký</button>

 <a href="login.html">Đã có tài khoản?</a>
 <a href="index.html">⬅ Trang chủ</a>
</div>

<div id="loading" class="loading">
 <div class="spinner"></div>
</div>

<script>
const loading=document.getElementById('loading');
const msg=document.getElementById('formMsg');

function showFormMsg(text,type){
 msg.style.display='block';
 msg.className='form-msg '+type;
 msg.innerText=text;
}

async function register(){
 const u=user.value.trim();
 const p=pass.value.trim();
 const r=repass.value.trim();

 if(!u||!p||!r){
  showFormMsg('Vui lòng nhập đầy đủ thông tin','warn');
  return;
 }

 if(p!==r){
  showFormMsg('Mật khẩu nhập lại không khớp','error');
  return;
 }

 loading.style.display='flex';

 try{
  // User có sẵn từ file
  const res=await fetch('users.json');
  const fileUsers=await res.json();

  // User đăng ký local
  let localUsers=JSON.parse(localStorage.getItem('localUsers'))||[];

  // Check trùng
  const exist=
    fileUsers.find(x=>x.username===u) ||
    localUsers.find(x=>x.username===u);

  if(exist){
   loading.style.display='none';
   showFormMsg('Tên đăng nhập đã tồn tại','error');
   return;
  }

  const newUser={
   username:u,
   password:p,
   money:100000
  };

  localUsers.push(newUser);
  localStorage.setItem('localUsers',JSON.stringify(localUsers));

  showFormMsg('Đăng ký thành công','success');

  // Auto login
  localStorage.setItem(
   'currentUser',
   JSON.stringify({
    username:newUser.username,
    money:newUser.money
   })
  );

  setTimeout(()=>location.href='index.html',900);

 }catch(e){
  loading.style.display='none';
  showFormMsg('Không thể đọc dữ liệu người dùng','error');
 }
}
</script>

</body>
</html>